import spacy
import pandas as pd
import scispacy
from scispacy.linking import EntityLinker
from spacy import displacy

# Load the SciSpaCy model for medical text
nlp = spacy.load("en_core_sci_sm")

# Example text (Symptoms in medical records)
text = "The patient shows signs of fever, continuous coughing, and shortness of breath."

# List of symptoms to match
symptom_list = [
    "fever", "cough", "shortness of breath", "headache", "fatigue", "nausea", "vomiting", "sore throat", "chills", "dizziness", "chest pain", "muscle aches", "loss of appetite", "sweating", "runny nose", "sneezing", "congestion", "body aches", "joint pain", "sore muscles", "diarrhea", "abdominal pain", "rash", "skin redness", "swelling", "coughing up blood", "wheezing", "blurry vision", "insomnia", "irritability", "confusion", "numbness", "tingling", "hearing loss", "difficulty swallowing", "hoarseness", "fatigue", "hypertension", "bradycardia", "tachycardia", "hypotension", "hyperglycemia", "hypoglycemia", "seizures", "syncope", "palpitations", "lightheadedness", "chest tightness", "wheezing", "flank pain", "hematuria", "oliguria", "anuria", "urinary retention", "incontinence", "elevated heart rate", "rapid breathing", "persistent cough", "night sweats", "bleeding gums", "jaundice", "hepatomegaly", "splenomegaly", "back pain", "visual disturbances", "weight loss", "fever spikes", "delirium", "restlessness", "tingling in hands", "weakness", "difficulty breathing", "swollen lymph nodes", "nausea with vomiting", "constant hunger", "polydipsia", "hearing ringing", "poor circulation", "cold hands and feet", "confusion", "visual floaters", "sensitivity to light", "difficulty walking", "fatigue after exertion", "unexplained bruising", "bone pain", "skin ulcer", "fainting", "sore throat with swollen lymph nodes", "sensitivity to cold", "pins and needles", "thickened skin", "dark-colored urine", "increased thirst", "dry mouth", "red eyes", "bloody stools", "chronic cough", "persistent fatigue", "yellowing of skin", "swollen ankles", "numbness in feet", "chronic fatigue", "palpitations with dizziness", "swollen abdomen", "tremors", "muscle weakness", "spitting blood", "persistent fever", "low blood pressure", "wheezing with coughing", "irregular heartbeat", "loss of consciousness", "abnormal breathing patterns", "confusion and disorientation", "blurred vision", "sudden weight loss", "unexplained fever", "fatigue after meals", "stomach cramps", "digestive problems", "gastrointestinal bleeding", "slow heart rate", "rash with itching", "ringing in ears", "Shortness of breath", "Wheezing", "Persistent cough", "Coughing up blood", "Chest tightness", "Chest pain", "Palpitations", "Irregular heartbeat", "Dizziness with exertion", "Difficulty breathing", "Rapid breathing", "Decreased lung sounds", "Pulmonary edema", "Stridor", "Rales", "Hypoxemia", "Hyperventilation", "Hypoventilation", "Labored breathing", "Frequent shallow breathing", "Sighing", "Nasal flaring", "Cyanosis", "Bluish lips", "Bluish fingertips", "Hypercapnia", "Crackling in chest", "Pain with deep breathing", "Pressure on chest", "Increased respiratory rate", "Swollen ankles", "Cold extremities", "Claudication", "Lower extremity edema", "Leg swelling", "Peripheral edema", "Elevated blood pressure", "Hypotension", "Orthopnea", "Paroxysmal nocturnal dyspnea", "Jugular vein distension", "Tachycardia", "Bradycardia", "Chest discomfort", "Elevated heart rate", "Weak pulse", "Bounding pulse", "Heart murmur", "Angina", "Myocardial infarction", "Aortic stenosis", "Coronary artery disease", "Fainting spells", "Lightheadedness", "Pulse irregularities", "Swollen veins", "Cardiomegaly", "Pulmonary hypertension", "Arrhythmia", "Heart palpitations", "Cardiac arrest", "Atrial fibrillation", "Systolic hypertension", "Diastolic hypertension", "Exertional dyspnea", "S3 heart sound", "S4 heart sound", "Rapid heart rate with exercise", "Decreased exercise tolerance", "Sudden decrease in blood pressure", "Tachypnea", "Hypotension with dizziness", "Elevated JVP", "Excessive perspiration", "Cold sweats", "Heart failure", "Peripheral vascular disease", "Pulmonary embolism", "Tachycardic rhythm", "Stiff arteries", "Pulmonary consolidation", "Sputum production", "Pleural effusion", "Acid reflux with chest pain", "Intermittent claudication", "Pitting edema in legs", "Persistent blood pressure fluctuations", "Exercise-induced wheezing", "Stiffness in the chest", "Pain radiating to the jaw", "Pain radiating to the left arm", "Sensation of pressure in chest", "Dizziness upon standing", "Fatigue with minimal exertion", "Elevated creatine kinase levels", "Abnormal ECG findings", "Dyspnea on exertion", "Dyspnea at rest", "Discomfort in upper chest", "Unexplained rapid heartbeat", "Unexplained shortness of breath", "Tightness in chest", "Increased heart rate after activity", "Decreased heart rate with activity", "Unusual heartbeat", "Frequent heart skips", "Shortness of breath at rest", "Pain with deep inspiration", "Increased heart rate at night", "Sudden drop in blood pressure", "Sudden increase in blood pressure", "Atypical chest pain", "Pale or ashen skin tone", "Sensation of chest fluttering", "Difficulty breathing after physical activity", "Increased heart rate with stress", "Difficulty catching breath after exertion", "Uncontrolled coughing", "Elevated systolic blood pressure", "Sweaty palms", "Increased heart rate at night", "Cold hands and feet with exercise", "Pulmonary crackles", "Rapid pulse during rest", "Heart pounding in chest", "Cardiovascular instability", "Pain on exertion", "Sudden chest tightness", "Pain when lying down", "Tingling sensation in chest", "Chronic cough with exertion", "Abnormal heart rhythms with exercise", "Heavy feeling in chest", "Inability to catch breath", "Sensation of heart skipping beats", "Swollen eyelids", "Muscle stiffness", "Weak legs", "Tingling toes", "Restless legs", "Skin blistering", "Dry cough", "Slow speech", "Burning mouth", "Difficulty raising arms", "Sensory overload", "Hair breakage", "Sleepwalking", "Sudden aggression", "Arm weakness", "Unexplained rash", "Excess mucus in throat", "Stomach noises", "Ear pain on swallowing", "Swollen tongue", "Face pain", "Muscle jerking", "Uncontrolled blinking", "Gurgling stomach", "Cough with phlegm", "Lower abdominal pain", "White spots on tonsils", "Scaly patches", "Difficulty closing eyes", "Poor hand coordination", "Nausea without vomiting", "Stiff upper lip", "Hoarseness without sore throat", "Excessive blinking", "Unexplained jaw pain", "Weakness in hands", "Tingling lips", "Dark patches on skin", "Shivering without fever", "Cold sweats", "Lump in breast", "Pain in upper arm", "Bloodshot sclera", "Frequent burping", "Muscle tightness", "Stomach bloating after meals", "Dry itchy scalp", "Eye strain", "Slow digestion", "Frequent ear infections", "Drooping eyelid", "Unusual sweating pattern", "Wobbly legs", "Delayed speech", "Irregular bowel movements", "Pain in shins", "Chronic sinus infections", "Puffy hands", "Burning legs", "Unexplained choking sensation", "Burning in throat", "Recurrent mouth ulcers", "Inability to relax", "Stomach twitching", "Twitching fingers", "Increased heart palpitations", "Constant buzzing in ears", "Restless arms", "Swollen upper lip", "Sudden weakness in arms", "Red, irritated skin", "Muscle spasms in back", "Facial twitching", "Twitching under eye", "Sharp chest pains", "Frequent hiccups", "Sharp shoulder pain", "Sudden urge to urinate", "White coating on tongue", "Loss of grip strength", "Short-term memory issues", "Loss of bladder sensation", "Pale gums", "Frequent nose rubbing", "Recurrent swollen feet", "Pounding in ears", "Skin sagging", "Tearing eyes", "Bloating with cramps", "Blue lips with cold", "Pulsating pain in head", "Yellow tongue coating", "Pain in lower ribcage", "Hot flashes at night", "Tight chest with exertion", "Swollen jaw", "Tired eyes", "Slow pulse", "Difficulty waking up", "Dry nostrils", "Nightmares with sweating", "Loss of interest in hobbies", "Persistent body odor", "Sudden head pressure", "Jaw locking", "Burning sensation in stomach", "Frequent bruising on legs", "Sudden excessive thirst", "Sensitivity to noise", "Recurrent fevers", "Puffy ankles", "Discoloration of fingers", "Poor skin elasticity", "Abnormal heart sounds", "Frequent congestion", "Tingling ears", "Stiff shoulders", "Hot hands and feet", "Fever", "Chills", "Fatigue", "Weakness", "Weight loss", "Weight gain", "Loss of appetite"
]

# Function to extract symptoms from the text
def extract_symptoms(text, symptom_list):
    doc = nlp(text)
    extracted_symptoms = []

    # Iterate through the entities found by the model and check if they match a symptom
    for ent in doc.ents:
        if ent.text.lower() in symptom_list:
            extracted_symptoms.append(ent.text.lower())

    return extracted_symptoms

# Load the dataset from CSV
df = pd.read_csv('/content/PMC-Patients-oa-9995.csv')

# Assuming 'patient' column contains the medical records. If not, change this to the correct column name.
df['extracted_symptoms'] = df['patient'].apply(lambda x: extract_symptoms(x, symptom_list))

# Save the results to a new CSV file
df.to_csv('extracted_symptoms.csv', index=False)

# Display the extracted symptoms
print(df[['patient_uid', 'extracted_symptoms']])
